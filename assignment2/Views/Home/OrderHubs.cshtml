<h2>Hub Orders Report</h2>
<br />
<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Order Status</th>
                <th>Order Amount</th>
                <th>Hub Name</th>
                <th>Hub City</th>
                <th>Hub State</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="HubsBody">
        </tbody>
    </table>
</div>

<!-- Edit Payment Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Payment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Edit Payment Form -->
                <form id="editForm">
                    <div class="form-group">
                        <input type="hidden" id="editorderid" />
                    </div>
                    <div class="form-group">
                        <label for="editOrderStatus">Order Status:</label>
                        <select class="form-control" id="editOrderStatus">
                            <option value='FINISHED'>FINISHED</option>
                            <option value='CANCELED'>CANCELED</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editOrderAmount">Order Amount:</label>
                        <input type="text" class="form-control" id="editOrderAmount">
                    </div>
                    <!-- Add more fields as needed -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="hideModal()" data-dismiss="modal">Close</button>
                        <button type="submit" onclick="onSaveChanges()" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
                <!-- End Edit Payment Form -->
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        LoadData();
    });

    function LoadData() {
        $.ajax({
            url: "/Home/ListFilteredHubs",
            type: "POST",
            data: '{}',
            contentType: "application/json; charset=utf-8",
            dataType: "JSON",
            success: function (response) {
                var tableBody = document.getElementById("HubsBody");
                tableBody.innerHTML = "";
                var jsonData = JSON.parse(response);
                $.each(jsonData, function (index, item) {
                    var tr = document.createElement('tr');
                    var row = "\n                    <td>" + item.order_id + "</td>\n                    <td>" + item.order_status + "</td>\n                    <td>" + item.order_amount + "</td>\n                    <td>" + item.hub_name + "</td>\n                    <td>" + item.hub_city + "</td>\n                    <td>" + item.hub_state + "</td>";
                    tr.innerHTML = row;

                    // Add Edit Button
                    var editButton = document.createElement('button');
                    editButton.innerText = 'Edit';
                    editButton.className = 'btn btn-primary btn-sm';
                    editButton.onclick = function () {
                        // Handle Edit button click event
                        editRow(item);
                    };

                    var editTd = document.createElement('td');
                    editTd.appendChild(editButton);
                    tr.appendChild(editTd);

                    // Add Delete Button
                    var deleteButton = document.createElement('button');
                    deleteButton.innerText = 'Delete';
                    deleteButton.className = 'btn btn-danger btn-sm';
                    deleteButton.onclick = function () {
                        // Handle Delete button click event
                        deleteRow(item);
                    };

                    var deleteTD = document.createElement('td');
                    deleteTD.appendChild(deleteButton);
                    tr.appendChild(deleteTD);


                    tableBody.appendChild(tr);
                });
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }

    // Delete Function
    function deleteRow(order) {
        if (confirm('Are you sure you want to delete this row?')) {
            // Perform an AJAX request to delete the item on the server
            $.ajax({
                url: "/Home/DeleteOrders",
                type: "POST",
                data: '{ paymentorderid: "' + order.order_id + '" }',
                contentType: "application/json; charset=utf-8",
                dataType: "JSON",
                success: function (response) {
                    LoadData();
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
    }

    function hideModal() {
        $(editModal).modal("hide");
    }

    function onSaveChanges() {
        var updatedOrderID = document.getElementById("editorderid").value;
        var updatedOrderStatus = document.getElementById("editOrderStatus").value;
        var updatedOrderAmount = document.getElementById("editOrderAmount").value;
        // Get other updated fields as needed

        // Perform an AJAX request to update the item on the server
        $.ajax({
            url: "/Home/UpdateOrder",
            type: "POST",
            dataType: "JSON",
            data: {
                OrderId: updatedOrderID,
                OrderStatus: updatedOrderStatus,
                OrderAmount: updatedOrderAmount,
                // Include other updated fields
            },
            success: function (response) {
                // Close the edit modal
                $(editModal).modal("hide");
                LoadData();
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }

    // Edit Function
    function editRow(item) {
        // Assuming you have a modal with id "editModal" for editing
        var editModal = document.getElementById("editModal");

        // Populate the modal fields with item data for editing
        document.getElementById("editorderid").value = item.order_id;
        document.getElementById("editOrderStatus").value = item.order_status;
        document.getElementById("editOrderAmount").value = item.order_amount;
        // Add more fields as needed

        // Show the edit modal
        $(editModal).modal("show");
    }

</script>